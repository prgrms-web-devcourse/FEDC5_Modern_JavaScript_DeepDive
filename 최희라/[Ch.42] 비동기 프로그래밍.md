# 비동기 프로그래밍

## 동기 처리와 비동기 처리

### 동기(synchronous) 처리

- **싱글 스레드**로 동작하는 자바스크립트 엔진에서 실행 중인 태스크가 종료될 때까지 다음 태스크가 대기하는 방식이다.
- 처리에 시간이 걸리는 태스크를 실행하는 경우 **블로킹(blocking, 작업 중단)** 이 발생한다.
- 실행 순서가 보장된다.

### 비동기(asynchronous) 처리

- 실행 중인 태스크가 종료되지 않았어도 다음 태스크를 곧바로 실행하는 방식이다.
- 블로킹이 발생하지 않는다.
- 실행 순서가 보장되지 않는다.
- 전통적으로 콜백 패턴이 사용되는데, 콜백 헬을 발생시켜 가독성이 나쁘며 에러 예외 처리가 곤란하다는 단점이 있다.
- `setTimeout`, `setInterval`, `HTTP 요청`, `이벤트 핸들러`는 비동기 처리 방식으로 동작한다.

## 이벤트 루프와 태스크 큐

비동기 처리에서 소스코드 평가, 실행을 제외한 모든 처리는 브라우저 또는 `Node.js`가 담당하며 이를 위해 태스크 큐와 이벤트 루프를 제공한다.

**자바스크립트 엔진은 싱글 스레드로 동작하지만 브라우저는 멀티 스레드로 동작**하며, 이벤트 루프가 자바스크립트의 동시성을 지원한다.

- 태스크 큐(task queue/event queue/callback queue)
    - 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역
    - 태스크 큐와는 별도로 프로미스 후속 처리 메서드의 콜백함수가 일시적으로 보관되는 마이크로태스크 큐도 존재
- 이벤트 루프(event loop)
    - 자바스크립트의 동시성을 지원하는 것
    - 콜 스택에 실행 중인 실행 컨텍스트가 있는지, 태스크 큐에 대기 중인 함수가 있는지 반복해서 확인
    - 콜 스택이 비어 있고 태스크 큐에 대기 중인 함수가 있다면 순차적(FIFO)으로 콜 스택으로 이동시킨다.